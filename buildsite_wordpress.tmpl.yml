name: Build_Site_Wordpress
description: 'Build a website with wordpress, provisioning AWS infraestructure'
project-type: freestyle
display-name: 'Build_Site_Wordpress'
scm:
  - git:
      url: https://github.com/donovosoft/ansible-scripts.git
      branches:
        - 'master'
      skip-tag: true
parameters:
  - string:
      name: Hostname
      description: 'HostName for the new site. For example: donovosoft.com'

builders:
  - shell: |
      #!/bin/bash 
      echo "Creating website $Hostname"
      `export AWS_SECRET_ACCES_KEY=$AWS_SECRET_ACCES_KEY && export AWS_SECRET_KEY_ID=$AWS_SECRET_KEY_ID
      `cd aws_env && ./ec2.py --refresh-cache`
      `cd ..`
      `ansible-playbook -i aws_env conf_playbooks/wordpress_site.yml -e vhost_name=$Hostname -vvvv`